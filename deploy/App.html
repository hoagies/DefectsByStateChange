<!DOCTYPE html>
<html>
<head>
    <title>Defect by State Change</title>

    <script type="text/javascript" src="/apps/2.0/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",title:"Dashboard Directory",launch:function(){var filters=Ext.create("Rally.data.lookback.QueryFilter",{property:"_TypeHierarchy",operator:"=",value:"Defect"}).and(Ext.create("Rally.data.lookback.QueryFilter",{property:"_ValidFrom",operator:"$gte",value:"2015-12-02"})).and(Ext.create("Rally.data.lookback.QueryFilter",{property:"c_TriageVerdict",operator:"!=",value:null})).and(Ext.create("Rally.data.lookback.QueryFilter",{property:"_PreviousValues.State",operator:"!=",value:null})).and(Ext.create("Rally.data.lookback.QueryFilter",{property:"State",operator:"!=",value:"Submitted"})).and(Ext.create("Rally.data.lookback.QueryFilter",{property:"State",operator:"!=",value:"Reopen"})).and(Ext.create("Rally.data.lookback.QueryFilter",{property:"State",operator:"!=",value:"Open"})),snapshotStore=Ext.create("Rally.data.lookback.SnapshotStore",{pageSize:200,limit:1e4,fetch:["Name","Parent","_PreviousValues.State","FormattedID","_UnformattedID","_ValidFrom","Project","State","_ItemHierarchy"],filters:filters,hydrate:["_PreviousValues.State","State","Project"],autoLoad:!0,listeners:{load:function(store,records){this._onLoad(store,records)},scope:this}})},_onLoad:function(store,records){function formatDate(date){if(!date)return"";var dateString=new Date(date);return thisYear=dateString.getFullYear(),thisMonth=("0"+(dateString.getMonth()+1)).slice(-2),thisDay=("0"+dateString.getDate()).slice(-2),thisDate=thisMonth+"/"+thisDay+"/"+thisYear}var defects=[],id;Ext.Array.each(records,function(record){id="DE"+record.get("_UnformattedID"),defects.push({Name:record.get("Name"),FormattedID:id,State:record.get("State"),Previous:record.get("_PreviousValues.State"),From:formatDate(record.get("_ValidFrom")),Project:record.get("Project").Name})});var myStore=Ext.create("Rally.data.custom.Store",{data:defects,groupField:"From",groupDir:"DESC",autoLoad:!0,pageSize:200,limit:1/0,listeners:{load:function(store,records){this._onLoad2(store)},scope:this}})},_onLoad2:function(store){function formatDate(date){if(!date)return"";var dateString=new Date(date);return thisYear=dateString.getFullYear(),thisMonth=("0"+(dateString.getMonth()+1)).slice(-2),thisDay=("0"+dateString.getDate()).slice(-2),thisDate=thisMonth+"/"+thisDay+"/"+thisYear}this.down("#DefectGrid")&&this.down("#DefectGrid").destroy(),this.add({xtype:"rallygrid",width:"99%",id:"DefectGrid",columnCfgs:[{text:"ID",dataIndex:"FormattedID",flex:1},{text:"Name",dataIndex:"Name",flex:10},{text:"Project",dataIndex:"Project",flex:3},{text:"Change Date",dataIndex:"From",flex:2},{text:"State",dataIndex:"State",flex:2},{text:"Previous State",dataIndex:"Previous",flex:2}],store:store})}});

            Rally.launchApp('CustomApp', {
                name:"Defect by State Change",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
